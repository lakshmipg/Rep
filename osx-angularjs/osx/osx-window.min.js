(function($){var winHtml="<div id=\"tableWindow\" class=\"osx-window\">\n"+"    <div class=\"osx-window-bg\"></div>\n"+"    <table class=\"osx-window-table\">\n"+"        <tr class=\"osx-window-titleTr\">\n"+"            <td>\n"+"                <ul class=\"osx-window-control\">\n"+"                    <li class=\"close\" title=\"close\"></li>\n"+"                    <li class=\"minimize\" title=\"minimize\"></li>\n"+"                    <li class=\"maximize\" title=\"maximize\"></li>\n"+"                </ul>\n"+"                <span class=\"osx-window-title\">oxs-window</span>\n"+"            </td>\n"+"        </tr>\n"+"        <tr class=\"osx-window-containerTr\" style=\"height: 100%;\">\n"+"            <td class=\"osx-window-containerTd\"></td>\n"+"        </tr>\n"+"    </table>\n"+"</div>";$.fn.osxWindow=function(method,opt){jQuery.osxUtils.logger.info('-------------------------- osxWindow --------------------------');opt=$.extend({},$.fn.osxWindow.constantConfig,opt);opt.id=(opt.id==null?('osx-window_'+new Date().getTime()+'_'+new String(Math.random()).substr(2)):opt.id);$.fn.osxWindow.dataObj[opt.id]=opt;var $win=$.fn.osxWindow[method]($(this),opt);return $win;};$.fn.osxWindow.constantConfig={id:null,title:'window',windowBackgroundColor:null,windowBackgroundOpacity:0.8,modal:false,hideControlWindowElements:null,resizable:true,draggable:true,width:'60%',height:'auto',showManner:'slideDown',hideManner:'slideUp',openAfterInit:true,maximizeAfterInit:false,confirmBeforeClose:false,beforeOpen:function($win){jQuery.osxUtils.logger.info('osx-window, beforeOpen...');return true;},afterOpen:function($win){jQuery.osxUtils.logger.info('osx-window, afterOpen...');return true;},beforeMinimize:function($win){jQuery.osxUtils.logger.info('osx-window, beforeMinimize...');return true;},afterMinimize:function($win){jQuery.osxUtils.logger.info('osx-window, afterMinimize...');return true;},beforeMaximize:function($win){jQuery.osxUtils.logger.info('osx-window, beforeMaximize...');return true;},afterMaximize:function($win){jQuery.osxUtils.logger.info('osx-window, afterMaximize...');return true;},beforeClose:function($win){jQuery.osxUtils.logger.info('osx-window, beforeClose...');return true;},afterClose:function(){jQuery.osxUtils.logger.info('osx-window, afterClose...');return true;}}
$.fn.osxWindow.dataObj={zIndex:400}
$.fn.osxWindow.init=function($content,opt){jQuery.osxUtils.logger.info('execute method of osxWindow: init');var $win=initWindowHtml($content,opt);jQuery.osxUtils.locateElement($win,$('body'));bindWindowEvent($win,opt);if(opt.openAfterInit){if(opt.maximizeAfterInit){$.fn.osxWindow.maximize($win,$.fn.osxWindow.dataObj[$win.attr('id')]);}
$.fn.osxWindow.open($win,$.fn.osxWindow.dataObj[$win.attr('id')]);}
return $win;}
function initWindowHtml($content,opt){jQuery.osxUtils.logger.info('init window html')
var $win=$(winHtml);$win.attr({id:opt.id}).css({position:'absolute',width:opt.width,height:opt.height,'z-index':$.fn.osxWindow.dataObj.zIndex++});$win.find('.osx-window-title').html(opt.title);$win.find('.osx-window-containerTd').append($content);$content.show();if(opt.modal){var $masker=$('<div class="osx-window-masker"/>');$masker.attr({id:'osx-window-masker_'+$win.attr('id')}).css('opacity',0.6);$masker.appendTo($(window.document.body));}
$win.appendTo($(window.document.body));if(opt.hideControlWindowElements!=null&&opt.hideControlWindowElements.length!=0){for(var i=0;i<opt.hideControlWindowElements.length;i++){$win.find('.'+opt.hideControlWindowElements[i]).remove();}}
return $win;}
function bindWindowEvent($win,opt){jQuery.osxUtils.logger.info('bind window event');$win.find('.osx-window-control > li').hover(function(){var className=$(this).attr('class');$(this).removeClass(className);$(this).addClass(className+'Hover');},function(){var className=$(this).attr('class');$(this).removeClass(className);$(this).addClass(className.substr(0,className.indexOf('Hover')));});$win.mousedown(function(){$(this).css({'z-index':$.fn.osxWindow.dataObj.zIndex++});});if(opt.draggable){var winConfig={cursor:'move',handle:'.osx-window-titleTr',containment:$(document.body)};$win.draggable(winConfig);}
if(opt.resizable){$win.resizable({containment:$('body')});}
$win.find('.close').click(function(){$.fn.osxWindow.close($win,$.fn.osxWindow.dataObj[$win.attr('id')]);});$win.find('.minimize').click(function(){$.fn.osxWindow.minimize($win,$.fn.osxWindow.dataObj[$win.attr('id')]);});$win.find('.osx-window-titleTr').dblclick(function(){$win.find('.maximize').click();});$win.find('.maximize').click(function(){$.fn.osxWindow.maximize($win,$.fn.osxWindow.dataObj[$win.attr('id')]);});}
$.fn.osxWindow.open=function($content,opt){jQuery.osxUtils.logger.info('execute method of osxWindow: open');$content=$content||$(this);var $win=$content.closest('.osx-window');opt=opt||$.fn.osxWindow.dataObj[$win.attr('id')];var flag=opt.beforeOpen($win);if(flag+''!='undefined'&&!flag){return;}
var $masker=$('#osx-window-masker_'+$win.attr('id'));if($masker.size()>0){$masker.css({'z-index':$.fn.osxWindow.dataObj.zIndex++}).fadeIn('fast');}
$win.css({'z-index':$.fn.osxWindow.dataObj.zIndex++})[opt.showManner]('fast');opt.afterOpen($win);}
$.fn.osxWindow.toggle=function($content,opt){jQuery.osxUtils.logger.info('execute method of osxWindow: open');$content=$content||$(this);var $win=$content.closest('.osx-window');opt=opt||$.fn.osxWindow.dataObj[$win.attr('id')];var display=$win.css('display');if(display=='none'){$win.osxWindow('open');}else{$win.osxWindow('minimize');}}
$.fn.osxWindow.maximize=function($content,opt){jQuery.osxUtils.logger.info('execute method of osxWindow: maximize');$content=$content||$(this);var $win=$content.closest('.osx-window');opt=opt||$.fn.osxWindow.dataObj[$win.attr('id')];var flag=opt.beforeMaximize($win);if(flag+''!='undefined'&&!flag){return;}
var _max=$win.attr('_max');if(_max=='y'){$win.attr({_max:'n'}).css({top:parseInt($win.attr('_top_src')),left:parseInt($win.attr('_left_src')),width:$win.attr('_width_src'),height:$win.attr('_height_src')});}else{$win.attr({_top_src:$win.position().top,_left_src:$win.position().left,_width_src:$win.width(),_height_src:$win.height(),_max:'y'}).css({top:0,left:0,width:$(window.document.body).width(),height:'92%'});}
opt.afterMaximize($win);}
$.fn.osxWindow.minimize=function($content,opt){jQuery.osxUtils.logger.info('execute method of osxWindow: minimize');$content=$content||$(this);var $win=$content.closest('.osx-window');opt=opt||$.fn.osxWindow.dataObj[$win.attr('id')];var flag=opt.beforeMinimize($win);if(flag+''!='undefined'&&!flag){return;}
$win.attr('_min','y');$win[opt.hideManner]('fast',function(){var $masker=$('#osx-window-masker_'+$win.attr('id'));if($masker.size()>0){$masker.hide('fast');}
opt.afterMinimize($win);});}
$.fn.osxWindow.close=function($content,opt){jQuery.osxUtils.logger.info('execute method of osxWindow: close');$content=$content||$(this);var $win=$content.closest('.osx-window');opt=opt||$.fn.osxWindow.dataObj[$win.attr('id')];var flag=opt.beforeClose($win);if(flag+''!='undefined'&&!flag){return;}
if(opt.confirmBeforeClose){$('<div>Are you really want to close this window?</div>').osxMessage('confirm',{title:'Window-Close-Confirm',onOk:function(){closeWin();}});}else{closeWin();}
function closeWin(){$win[opt.hideManner]('fast',function(){var $masker=$('#osx-window-masker_'+$win.attr('id'));if($masker.size()>0){$masker.remove();}
$.fn.osxWindow.dataObj[$win.attr('id')]=null;$win.remove();opt.afterClose();});}}})(jQuery);